<?xml version="1.0" encoding="UTF-8"?>
<!-- Log4j2 Configuration for sendMessageApi -->
<Configuration status="WARN" monitorInterval="30">
    <Properties>
        <Property name="LOG_PATTERN">
            %d{yyyy-MM-dd HH:mm:ss.SSS} %-5level %logger{36} - %msg%n
        </Property>
        <Property name="LOG_FILE_NAME">logs/sendMessageApi.log</Property>
        <Property name="JSON_TEMPLATE_FILE">classpath:StructuredLogLayoutSendMessageApi.json</Property>
    </Properties>

    <Appenders>
        <!-- Console Appender -->
        <Console name="Console" target="SYSTEM_OUT">
            <PatternLayout pattern="${LOG_PATTERN}"/>
        </Console>

        <!-- Rolling File Appender for structured JSON logs -->
        <RollingFile name="JsonFile"
                     fileName="${LOG_FILE_NAME}.json"
                     filePattern="logs/sendMessageApi-%d{yyyy-MM-dd}-%i.json.gz">
            <JsonTemplateLayout eventTemplateUri="${JSON_TEMPLATE_FILE}"/>
            <Policies>
                <TimeBasedTriggeringPolicy/>
                <SizeBasedTriggeringPolicy size="10 MB"/>
            </Policies>
            <DefaultRolloverStrategy max="10"/>
        </RollingFile>

        <!--
        Abstracted Appender Configurations for Production Systems
        These would be enabled and configured in a production environment.
        -->

        <!-- Kafka Appender Example (requires log4j-kafka appender dependency) -->
        <!--
        <Kafka name="Kafka" topic="log-topic-messaging">
            <PatternLayout pattern="%m" />
            <Property name="bootstrap.servers">kafka-broker1:9092,kafka-broker2:9092</Property>
        </Kafka>
        -->

        <!-- Azure Event Hubs Appender Example (requires a custom or third-party appender) -->
        <!--
        <EventHubs name="EventHubs" connectionString="..." eventHubName="logs">
            <JsonTemplateLayout eventTemplateUri="${JSON_TEMPLATE_FILE}" />
        </EventHubs>
        -->
    </Appenders>

    <Loggers>
        <Root level="info">
            <AppenderRef ref="Console"/>
            <AppenderRef ref="JsonFile"/>
            <!-- <AppenderRef ref="Kafka"/> -->
            <!-- <AppenderRef ref="EventHubs"/> -->
        </Root>

        <Logger name="com.example.messaging" level="info" additivity="false">
            <AppenderRef ref="Console"/>
            <AppenderRef ref="JsonFile"/>
        </Logger>

        <!-- Quieter logs for Spring/Hibernate -->
        <Logger name="org.springframework.boot" level="warn" additivity="false">
            <AppenderRef ref="Console"/>
            <AppenderRef ref="JsonFile"/>
        </Logger>
        <Logger name="org.hibernate" level="warn" additivity="false">
            <AppenderRef ref="Console"/>
            <AppenderRef ref="JsonFile"/>
        </Logger>

    </Loggers>
</Configuration>
```
```json
{
  "timestamp": {
    "$resolver": "timestamp",
    "pattern": {
      "format": "yyyy-MM-dd'T'HH:mm:ss.SSS'Z'",
      "timeZone": "UTC"
    }
  },
  "level": {
    "$resolver": "level",
    "field": "name"
  },
  "traceId": {
    "$resolver": "mdc",
    "key": "traceId"
  },
  "loggerName": {
    "$resolver": "logger",
    "field": "name"
  },
  "message": {
    "$resolver": "message",
    "stringified": true
  },
  "event": {
    "$resolver": "map"
  },
  "exception": {
    "$resolver": "exception",
    "stackTrace": {
      "stringified": true
    }
  }
}
```
```java